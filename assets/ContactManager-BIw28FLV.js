import{a as oe,H as ae,m as ne,b as f,Q as ce,o as r,c as h,g as e,t as i,h as k,f as c,w as d,v as p,x as D,u as l,F as U,e as O,n as P,y as _,G as g,s as b,E as le,M as de,O as ie,$ as re,a0 as he,R as ue,a1 as _e,W as pe}from"./index-BMd-QA-V.js";import{_ as $}from"./DErrors-Beq5o5sd.js";const ve={class:"flex-shrink-0"},me=e("i",{class:"ri ri-user-add-line",size:"lg"},null,-1),fe={key:0,class:"position-absolute topbar-badge fs-10 translate-middle badge rounded-pill bg-danger"},ge={class:"d-flex"},be={class:"search-box flex-grow-1"},ye=["placeholder"],ke=e("i",{class:"ri-search-2-line search-icon ml-3"},null,-1),Ee={class:"row mt-3 list-contact"},Re={class:"col-12"},we={class:"form-group"},Ue={key:0,class:"list-contact py-2 px-3 border border-groove rounded"},Ce={class:"col-6"},Ve={class:"d-flex my-2"},Ne={class:"avatar-xs me-1"},xe=["src"],De={class:"mt-1 fw-bold"},Oe={class:"col-6"},Pe={class:"d-flex justify-content-end my-2"},$e={class:"me-2"},Ae={class:"me-2"},Ie={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},Se={key:1,class:"list-contact py-2 px-3 border border-groove rounded"},Te={class:"position-relative"},Fe={key:0,class:"position-absolute top-0 start-100 translate-middle badge border border-light rounded-circle bg-danger p-1"},Qe={class:"visually-hidden"},je={class:"d-flex"},qe={class:"search-box flex-grow-1"},ze=["placeholder"],Me=e("i",{class:"ri-search-2-line search-icon ml-3"},null,-1),Be={class:"mb-2"},He={class:"my-2 bg-light p-2 border border-groove rounded"},Ke={class:"text-capitalize bold"},We={class:"row mt-3 list-contact"},Ge={class:"col-12"},Le={class:"form-group"},Je={key:0,class:"list-contact py-2 px-3 border border-groove rounded"},Xe={class:"col-6 my-2"},Ye={class:"d-flex mx-2"},Ze={class:"avatar-xs me-1"},es=["src"],ss={class:"mt-1 fw-bold"},ts={class:"col-6"},os={class:"d-flex justify-content-end my-2"},as={class:"me-2"},ns={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},cs={class:"me-2"},ls={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},ds={key:1,class:"list-contact py-2 px-3 border border-groove rounded"},is={class:"row mt-3"},rs={class:"d-flex"},hs={class:"flex-grow-1"},us={key:0},_s={class:"flex-shrink-0"},ps={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},vs={class:"d-flex"},ms={class:"search-box flex-grow-1"},fs=["placeholder"],gs=e("i",{class:"ri-search-2-line search-icon ml-3"},null,-1),bs={class:"row mt-3"},ys={class:"col-12"},ks={class:"form-group"},Es={class:"my-2 bg-light p-2 border border-groove rounded"},Rs={class:"text-capitalize bold"},ws={class:"row list-contact"},Us={class:"col-12"},Cs={class:"form-group"},Vs={key:0,class:"list-contact py-2 px-3 border border-groove rounded"},Ns={class:"col-md-6 mb-2"},xs={class:"my-2 pt-1"},Ds={class:"d-flex mx-2"},Os={class:"avatar-xs me-1"},Ps=["src"],$s={class:"mt-1 fw-bold"},As={class:"col-6"},Is={class:"d-flex justify-content-end my-2"},Ss={class:"me-2"},Ts={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},Fs={key:1,class:"list-contact py-2 px-3 border border-groove rounded"},Qs={class:"row mt-3"},js={class:"d-flex"},qs={class:"flex-grow-1"},zs={key:0},Ms={class:"flex-shrink-0"},Bs={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},Hs={class:"d-flex"},Ks={class:"search-box flex-grow-1"},Ws=["placeholder"],Gs=e("i",{class:"ri-search-2-line search-icon ml-3"},null,-1),Ls={class:"row mt-3"},Js={class:"col-12"},Xs={class:"form-group"},Ys={class:"mb-2"},Zs={class:"my-2 bg-light p-2 border border-groove rounded"},et={class:"text-capitalize bold"},st={key:0,class:"list-contact py-2 px-3 border border-groove rounded"},tt={class:"col-md-6 mb-2"},ot={class:"my-2 pt-1"},at={class:"d-flex mx-2"},nt={class:"avatar-xs me-1"},ct=["src"],lt={class:"mt-1 fw-bold"},dt={class:"col-6"},it={class:"d-flex justify-content-end my-2"},rt={class:"me-2"},ht={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},ut={key:1,class:"list-contact py-2 px-3 border border-groove rounded"},_t={class:"row mt-3"},pt={class:"d-flex"},vt={class:"flex-grow-1"},mt={key:0},ft={class:"flex-shrink-0"},gt={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},Et={__name:"ContactManager",setup(bt){const t=oe(),Q=ae.useEvent(),o=ne({overlay:!1,saving:!1,disabled:!0,modal:!1,check_all:!1,check_all_approve:!1,check_all_requested:!1,keyword:"",tab_active:0,users:[],notice_contact:0});o.notice_contact=f(()=>Object.keys(t.chat.APPROVE).length),ce(()=>{I()});const C=function(){o.modal=!1},j=function(s){switch(o.tab_active=s,s){case 1:I();break;case 2:z();break;case 3:M();break}},q=async function(s){const a=parseInt(t.chat.CONTACT[s.id].room_id);Q.emit("change-room",{id:a}),C()},I=async function(){Object.keys(t.chat.APPROVE).length||(o.overlay=!0,await t.getApproveContact(),o.overlay=!1)},z=async function(){Object.keys(t.chat.REQUESTED).length||(o.overlay=!0,await t.getRequestedContact(),o.overlay=!1)},M=async function(){o.overlay=!0,await t.getUnfriendContact(),o.overlay=!1},A=f(()=>t.users?t.users.filter(s=>s.name.includes(o.keyword)):[]),S=f(()=>Object.values(t.chat.APPROVE).filter(s=>s.name.includes(o.keyword))),T=f(()=>Object.values(t.chat.REQUESTED).filter(s=>s.name.includes(o.keyword))),F=f(()=>Object.values(t.chat.UNFRIEND).filter(s=>s.name.includes(o.keyword))),B=function(){for(let s in t.chat.UNFRIEND)t.chat.UNFRIEND[s].check=o.check_all},H=function(){for(let s in t.chat.REQUESTED)t.chat.REQUESTED[s].check=o.check_all_requested},K=function(){for(let s in t.chat.APPROVE)t.chat.APPROVE[s].check=o.check_all_approve},E=f(()=>{let s=[];for(const a in t.chat.UNFRIEND)t.chat.UNFRIEND[a].check&&s.push(a);return s}),R=f(()=>{let s=[];for(const a in t.chat.REQUESTED)t.chat.REQUESTED[a].check&&s.push(a);return s}),w=f(()=>{let s=[];for(const a in t.chat.APPROVE)t.chat.APPROVE[a].check&&s.push(a);return s}),W=async function(){o.saving=!0;const s=await t.addContact({ids:E.value});if(s.success){for(const a of E.value)Object.keys(t.chat.REQUESTED).length&&(t.chat.REQUESTED[a]=t.chat.UNFRIEND[a]),Object.keys(t.chat.UNFRIEND).length&&delete t.chat.UNFRIEND[a];o.tab_active=2,b({icon:"success",title:"Đã gửi lời mời kết bạn thành công"})}else o.response=s;o.saving=!1},G=async function(){o.saving=!0;const s=await t.unRequestContact({ids:R.value});if(s.success){for(const a of R.value)Object.keys(t.chat.UNFRIEND).length&&(t.chat.UNFRIEND[a]=t.chat.REQUESTED[a]),Object.keys(t.chat.REQUESTED).length&&delete t.chat.REQUESTED[a];o.tab_active=3,b({icon:"success",title:"Đã hủy yêu cầu kết bạn thành công"})}else o.response=s;o.saving=!1},L=async function(){o.saving=!0;const s=await t.cancelContact({ids:w.value});if(s.success){for(const a of w.value)Object.keys(t.chat.APPROVE).length&&delete t.chat.APPROVE[a];o.tab_active=3,b({icon:"success",title:"Đã từ chối kết bạn thành công"})}else o.response=s;o.saving=!1},J=async function(s){s.saving=!0;const a=await t.addContact({ids:[s.id]});a.success?(Object.keys(t.chat.REQUESTED).length&&(t.chat.REQUESTED[s.id]=t.chat.UNFRIEND[s.id]),Object.keys(t.chat.UNFRIEND).length&&delete t.chat.UNFRIEND[s.id],o.tab_active=2,b({icon:"success",title:"Đã gửi lời mời kết bạn đến "+s.name})):o.response=a,s.saving=!1},X=async function(s){s.saving=!0;const a=await t.approveContact({ids:[s.id]});a.success?(Object.keys(t.chat.APPROVE).length&&delete t.chat.APPROVE[s.id],o.tab_active=0,b({icon:"success",title:"Đã chấp nhận yêu cầu kết bạn từ "+s.name})):o.response=a,s.saving=!1},Y=async function(s){s.canceling=!0;const a=await t.cancelContact({ids:[s.id]});a.success?(Object.keys(t.chat.APPROVE).length&&delete t.chat.APPROVE[s.id],o.tab_active=3,b({icon:"success",title:"Đã từ chối cầu kết bạn từ "+s.name})):o.response=a,s.canceling=!1},Z=async function(s){s.saving=!0;const a=await t.unRequestContact({ids:[s.id]});a.success?(Object.keys(t.chat.UNFRIEND).length&&(t.chat.UNFRIEND[s.id]=t.chat.REQUESTED[s.id]),Object.keys(t.chat.REQUESTED).length&&delete t.chat.REQUESTED[s.id],o.tab_active=3,b({icon:"success",title:"Đã hủy yêu cầu kết bạn đến "+s.name})):o.response=a,s.saving=!1},ee=async function(s){le({title:"Hủy kết bạn với "+s.name}).then(async a=>{if(a.isConfirmed){s.saving=!0;const u=await t.removeContact({ids:[s.id]});u.success?(Object.keys(t.chat.USER).length&&delete t.chat.USER[s.id],o.tab_active=3,b({icon:"success",title:"Đã hủy kết bạn với "+s.name})):o.response=u,s.saving=!1}})};return(s,a)=>{const u=de,V=ie,N=re,x=he,y=ue,se=_e,te=pe;return r(),h("div",ve,[e("div",null,[e("button",{type:"button",class:"btn btn-ghost-success btn-icon",size:"lg",onClick:a[0]||(a[0]=n=>o.modal=!0),title:"Quản lý danh bạ"},[me,o.notice_contact>0?(r(),h("span",fe,i(o.notice_contact),1)):k("",!0)])]),c(te,{modelValue:o.modal,"onUpdate:modelValue":a[12]||(a[12]=n=>o.modal=n),title:"Quản lý danh bạ",scrollable:"",size:"lg","hide-footer":""},{default:d(()=>[c(se,{modelValue:o.tab_active,"onUpdate:modelValue":a[11]||(a[11]=n=>o.tab_active=n),onActivateTab:j},{default:d(()=>[c(x,{title:s.$t("chat.message.contact")},{default:d(()=>[c(N,null,{default:d(()=>[c($,{response:o.response},null,8,["response"]),e("div",ge,[e("span",be,[p(e("input",{type:"text",class:"form-control bg-light border-light",placeholder:s.$t("chat.message.search-contact"),"onUpdate:modelValue":a[1]||(a[1]=n=>o.keyword=n)},null,8,ye),[[D,o.keyword]]),ke])]),c(V,{show:o.overlay,rounded:"max","spinner-variant":"secondary"},{default:d(()=>[e("div",Ee,[e("div",Re,[e("div",we,[l(A).length>0?(r(),h("div",Ue,[(r(!0),h(U,null,O(l(A),(n,v)=>(r(),h(U,{key:v},[n.id!==l(t).chat.CURRENT_USER.id?(r(),h("div",{key:0,class:P(["row border-1",{"border-bottom-groove":v<=l(A).length-2}])},[e("div",Ce,[e("div",Ve,[e("div",Ne,[e("img",{class:"rounded-circle img-fluid",src:"https://ui-avatars.com/api/?name="+n.name},null,8,xe)]),e("span",De,i(n.name),1)])]),e("div",Oe,[e("div",Pe,[e("div",$e,[c(u,{class:"btn btn-outline-success",size:"sm",onClick:m=>q(n)},{default:d(()=>[_(i(s.$t("chat.message.chat")),1)]),_:2},1032,["onClick"])]),e("div",Ae,[c(u,{class:"btn-outline-danger",size:"sm",onClick:m=>ee(l(t).chat.USER[n.id])},{default:d(()=>[p(e("span",Ie,null,512),[[g,l(t).chat.USER[n.id].destroy]]),_(" "+i(s.$t("chat.message.remove-contact")),1)]),_:2},1032,["onClick"])])])])],2)):k("",!0)],64))),128))])):(r(),h("div",Se,i(s.$t("chat.message.empty-contact")),1))])])])]),_:1},8,["show"])]),_:1})]),_:1},8,["title"]),c(x,{title:""},{title:d(()=>[e("div",Te,[_(i(s.$t("chat.message.approve"))+" ",1),o.notice_contact>0?(r(),h("span",Fe,[e("span",Qe,i(o.notice_contact),1)])):k("",!0)])]),default:d(()=>[c(N,null,{default:d(()=>[c($,{response:o.response},null,8,["response"]),e("div",je,[e("span",qe,[p(e("input",{type:"text",class:"form-control bg-light border-light",placeholder:s.$t("chat.message.search-contact"),"onUpdate:modelValue":a[2]||(a[2]=n=>o.keyword=n)},null,8,ze),[[D,o.keyword]]),Me])]),e("div",Be,[e("div",He,[c(y,{modelValue:o.check_all_approve,"onUpdate:modelValue":a[3]||(a[3]=n=>o.check_all_approve=n),onChange:a[4]||(a[4]=n=>K()),id:"check_all_approve"},{default:d(()=>[e("span",Ke,i(s.$t("chat.message.check-all")),1)]),_:1},8,["modelValue"])])]),c(V,{show:o.overlay,rounded:"max",style:{"min-height":"300px"},"spinner-variant":"secondary"},{default:d(()=>[e("div",We,[e("div",Ge,[e("div",Le,[l(S).length>0?(r(),h("div",Je,[(r(!0),h(U,null,O(l(S),(n,v)=>(r(),h("div",{key:v,class:P(["row border-1",{"border-top-groove":v>0}])},[e("div",Xe,[c(y,{modelValue:l(t).chat.APPROVE[n.id].check,"onUpdate:modelValue":m=>l(t).chat.APPROVE[n.id].check=m,id:"check-item-approve-"+n.id,class:"mt-2"},{default:d(()=>[e("div",Ye,[e("div",Ze,[e("img",{class:"rounded-circle img-fluid",src:"https://ui-avatars.com/api/?name="+n.name},null,8,es)]),e("span",ss,i(n.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","id"])]),e("div",ts,[e("div",os,[e("div",as,[c(u,{type:"submit",size:"sm",class:"btn-outline-success",onClick:m=>X(l(t).chat.APPROVE[n.id])},{default:d(()=>[p(e("span",ns,null,512),[[g,l(t).chat.APPROVE[n.id].saving]]),_(" "+i(s.$t("chat.message.send-contact")),1)]),_:2},1032,["onClick"])]),e("div",cs,[c(u,{class:"btn-outline-danger",size:"sm",onClick:m=>Y(l(t).chat.APPROVE[n.id])},{default:d(()=>[p(e("span",ls,null,512),[[g,l(t).chat.APPROVE[n.id].canceling]]),_(" "+i(s.$t("chat.message.deny")),1)]),_:2},1032,["onClick"])])])])],2))),128))])):(r(),h("div",ds,i(s.$t("chat.message.empty-contact")),1))])])])]),_:1},8,["show"]),e("div",is,[e("div",rs,[e("div",hs,[l(w).length>0?(r(),h("span",us," Bạn đã chọn "+i(l(w).length)+" thành viên. ",1)):k("",!0)]),e("div",_s,[c(u,{type:"submit",variant:"secondary",class:"w-sm me-2",disabled:o.saving||l(w).length===0,onClick:L},{default:d(()=>[p(e("span",ps,null,512),[[g,o.saving]]),_(" "+i(s.$t("chat.message.not-approve-all")),1)]),_:1},8,["disabled"]),c(u,{variant:"outline-secondary",onClick:C},{default:d(()=>[_(i(s.$t("common.form.cancel")),1)]),_:1})])])])]),_:1})]),_:1}),c(x,{title:s.$t("chat.message.requested")},{default:d(()=>[c(N,null,{default:d(()=>[c($,{response:o.response},null,8,["response"]),e("div",vs,[e("span",ms,[p(e("input",{type:"text",class:"form-control bg-light border-light",placeholder:s.$t("chat.message.search-contact"),"onUpdate:modelValue":a[5]||(a[5]=n=>o.keyword=n)},null,8,fs),[[D,o.keyword]]),gs])]),e("div",bs,[e("div",ys,[e("div",ks,[e("div",Es,[c(y,{modelValue:o.check_all_requested,"onUpdate:modelValue":a[6]||(a[6]=n=>o.check_all_requested=n),onChange:a[7]||(a[7]=n=>H()),id:"check_all_requested"},{default:d(()=>[e("span",Rs,i(s.$t("chat.message.check-all")),1)]),_:1},8,["modelValue"])]),c(V,{show:o.overlay,rounded:"max",style:{"min-height":"300px"},"spinner-variant":"secondary"},{default:d(()=>[e("div",ws,[e("div",Us,[e("div",Cs,[l(T).length>0?(r(),h("div",Vs,[(r(!0),h(U,null,O(l(T),(n,v)=>(r(),h("div",{key:v,class:P(["row border-1",{"border-top-groove":v>0}])},[e("div",Ns,[e("div",xs,[c(y,{modelValue:l(t).chat.REQUESTED[n.id].check,"onUpdate:modelValue":m=>l(t).chat.REQUESTED[n.id].check=m,id:"check-item-"+n.id,class:"mt-2"},{default:d(()=>[e("div",Ds,[e("div",Os,[e("img",{class:"rounded-circle img-fluid",src:"https://ui-avatars.com/api/?name="+n.name},null,8,Ps)]),e("span",$s,i(n.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","id"])])]),e("div",As,[e("div",Is,[e("div",Ss,[c(u,{class:"btn-outline-danger",size:"sm",onClick:m=>Z(l(t).chat.REQUESTED[n.id])},{default:d(()=>[p(e("span",Ts,null,512),[[g,l(t).chat.REQUESTED[n.id].un_requested]]),_(" "+i(s.$t("chat.message.cancel-request")),1)]),_:2},1032,["onClick"])])])])],2))),128))])):(r(),h("div",Fs,i(s.$t("chat.message.empty-contact")),1))])])])]),_:1},8,["show"])])])]),e("div",Qs,[e("div",js,[e("div",qs,[l(R).length>0?(r(),h("span",zs," Bạn đã chọn "+i(l(R).length)+" thành viên. ",1)):k("",!0)]),e("div",Ms,[c(u,{type:"submit",variant:"secondary",class:"w-sm me-2",disabled:o.saving||l(R).length===0,onClick:G},{default:d(()=>[p(e("span",Bs,null,512),[[g,o.saving]]),_(" "+i(s.$t("chat.message.not-request-all")),1)]),_:1},8,["disabled"]),c(u,{variant:"outline-secondary",onClick:C},{default:d(()=>[_(i(s.$t("common.form.cancel")),1)]),_:1})])])])]),_:1})]),_:1},8,["title"]),c(x,{title:s.$t("chat.message.find-contact")},{default:d(()=>[c(N,null,{default:d(()=>[c($,{response:o.response},null,8,["response"]),e("div",Hs,[e("span",Ks,[p(e("input",{type:"text",class:"form-control bg-light border-light",placeholder:s.$t("chat.message.search-contact"),"onUpdate:modelValue":a[8]||(a[8]=n=>o.keyword=n)},null,8,Ws),[[D,o.keyword]]),Gs])]),e("div",Ls,[e("div",Js,[e("div",Xs,[e("div",Ys,[e("div",Zs,[c(y,{modelValue:o.check_all,"onUpdate:modelValue":a[9]||(a[9]=n=>o.check_all=n),onChange:a[10]||(a[10]=n=>B()),id:"check_all_contact"},{default:d(()=>[e("span",et,i(s.$t("chat.message.check-all")),1)]),_:1},8,["modelValue"])])]),c(V,{show:o.overlay,rounded:"max",style:{"min-height":"300px"},"spinner-variant":"secondary"},{default:d(()=>[l(F).length>0?(r(),h("div",st,[(r(!0),h(U,null,O(l(F),(n,v)=>(r(),h("div",{key:v,class:P(["row border-1",{"border-top-groove":v>0}])},[e("div",tt,[e("div",ot,[c(y,{modelValue:l(t).chat.UNFRIEND[n.id].check,"onUpdate:modelValue":m=>l(t).chat.UNFRIEND[n.id].check=m,id:"check-item-"+n.id,class:"mt-2"},{default:d(()=>[e("div",at,[e("div",nt,[e("img",{class:"rounded-circle img-fluid",src:"https://ui-avatars.com/api/?name="+n.name},null,8,ct)]),e("span",lt,i(n.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","id"])])]),e("div",dt,[e("div",it,[e("div",rt,[c(u,{type:"submit",class:"btn-outline-success",onClick:m=>J(l(t).chat.UNFRIEND[n.id])},{default:d(()=>[p(e("span",ht,null,512),[[g,l(t).chat.UNFRIEND[n.id].saving]]),_(" Kết bạn ")]),_:2},1032,["onClick"])])])])],2))),128))])):(r(),h("div",ut,i(s.$t("chat.message.empty-contact")),1))]),_:1},8,["show"])])])]),e("div",_t,[e("div",pt,[e("div",vt,[l(E).length>0?(r(),h("span",mt," Bạn đã chọn "+i(l(E).length)+" thành viên. ",1)):k("",!0)]),e("div",ft,[c(u,{type:"submit",variant:"secondary",class:"w-sm me-2",disabled:o.saving||l(E).length===0,onClick:W},{default:d(()=>[p(e("span",gt,null,512),[[g,o.saving]]),_(" Kết bạn với thành viên đã check ")]),_:1},8,["disabled"]),c(u,{variant:"outline-secondary",onClick:C},{default:d(()=>[_(i(s.$t("common.form.cancel")),1)]),_:1})])])])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}};export{Et as default};

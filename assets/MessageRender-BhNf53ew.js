import{U as H,a as b,H as $,l as Y,u as c,o as u,c as f,g as l,t as R,h as y,f as O,F as G,_ as N,P as J,p as W,k as ee,d as L,m as K,Q as q,e as te,V as se,b as S,X as ae,y as ne,r as oe,Z as re}from"./index-BMd-QA-V.js";import{C as r}from"./regex-CP_ygsHJ.js";import{C as z}from"./emoji-B_StZ82w.js";import ie from"./ImageFile-SGnJshYu.js";var V=function(s,a,i){if(!a.hasOwnProperty(i)){var d=Object.getOwnPropertyDescriptor(s,i);Object.defineProperty(a,i,d)}};const ce={props:{template:String,parent:Object,templateProps:{type:Object,default:function(){return{}}}},render:function(){if(this.template){var s=this.parent||this.$parent,a=s.$data;a===void 0&&(a={});var i=s.$props;i===void 0&&(i={});var d=s.$options;d===void 0&&(d={});var n=d.components;n===void 0&&(n={});var g=d.computed;g===void 0&&(g={});var _=d.methods;_===void 0&&(_={});var v=this.$data;v===void 0&&(v={});var p=this.$props;p===void 0&&(p={});var A=this.$options;A===void 0&&(A={});var k=A.methods;k===void 0&&(k={});var x=A.computed;x===void 0&&(x={});var I=A.components;I===void 0&&(I={});var T={$data:{},$props:{},$options:{},components:{},computed:{},methods:{}};Object.keys(a).forEach(function(h){v[h]===void 0&&(T.$data[h]=a[h])}),Object.keys(i).forEach(function(h){p[h]===void 0&&(T.$props[h]=i[h])}),Object.keys(_).forEach(function(h){k[h]===void 0&&(T.methods[h]=_[h])}),Object.keys(g).forEach(function(h){x[h]===void 0&&(T.computed[h]=g[h])}),Object.keys(n).forEach(function(h){I[h]===void 0&&(T.components[h]=n[h])});var w=Object.keys(T.methods||{}),U=Object.keys(T.$data||{}),j=Object.keys(T.$props||{}),o=Object.keys(this.templateProps),t=U.concat(j).concat(w).concat(o),e=(E=s,M={},w.forEach(function(h){return V(E,M,h)}),M),m=function(h){var B={};return h.forEach(function(P){P&&Object.getOwnPropertyNames(P).forEach(function(Z){return V(P,B,Z)})}),B}([T.$data,T.$props,e,this.templateProps]);return H({template:this.template||"<div></div>",props:t,computed:T.computed,components:T.components,provide:this.$parent.$.provides?this.$parent.$.provides:{}},Object.assign({},m))}var E,M}},le={class:"flex-shrink-0 chat-user-img online user-own-img align-self-center me-1 ms-0"},me=["src"],de={class:"flex-grow-1 pe-1"},ue={class:"text-truncate mb-0 text-dark text-capitalize"},F={__name:"TagAuth",props:["id"],setup(s){const a=b(),i=$.useEvent();return Y(!1),(d,n)=>c(a).chat.USER[s.id]?(u(),f("div",{key:0,class:"d-flex align-items-center cursor-pointer border border-groove me-2 my-1 pe-1",onClick:n[0]||(n[0]=g=>c(i).emit("show-modal-user-info",s.id))},[l("div",le,[l("img",{src:c(a).chat.USER[s.id].avatar?c(a).chat.USER[s.id].avatar:"https://ui-avatars.com/api/?name="+c(a).chat.USER[s.id].name,class:"avatar-xxs",alt:"store.chat.USER[id].name"},null,8,me)]),l("div",de,[l("span",ue,[l("a",null,R(c(a).chat.USER[s.id].name),1)])])])):y("",!0)}},_e={class:"message-icon"},pe={class:"d-flex flex-nowrap align-items-center message-icon"},he=l("span",{class:"ico to"}," TO ",-1),fe={__name:"MessageToIcon",props:["user_id"],setup(s){b();const a=s;return(i,d)=>(u(),f("span",_e,[l("span",pe,[he,O(F,{id:a.user_id},null,8,["id"])])]))}},ge={class:"d-flex align-items-center message-icon"},ve=l("span",{class:"ico re"}," reply ",-1),Ee={class:"reply"},Ae={__name:"MessageReplyIcon",props:["uid","mid","rid"],setup(s){const a=b(),i=s,d=a.chat.MESSAGE[i.rid+"_"+i.mid];return(n,g)=>(u(),f(G,null,[l("span",ge,[ve,O(F,{id:i.uid},null,8,["id"])]),l("div",Ee,[O(X,{item:c(d)},null,8,["item"])])],64))}},Te={},xe={class:"code-copy-icon"};function be(s,a){return u(),f("span",xe," copy ")}const ke=N(Te,[["render",be]]),Re={class:"icon-emoji mr-1"},Oe=["src"],ye={__name:"MessageEmoji",props:["src"],setup(s){return(a,i)=>(u(),f("span",Re,[l("img",{src:s.src},null,8,Oe)]))}},Ie=["src"],$e={__name:"MessageImage",props:["img_id"],setup(s){const a=b(),i=Y({}),d=new J,n=$.useEvent(),g=s,_=function(){n.emit("show-image-modal",g.img_id)},v=function(p){a.chat.FILE[p]&&a.chat.FILE[p].blob&&i.value?a.chat.FILE[p].type==="image"&&(i.value.src=a.chat.FILE[p].blob):d.getImage({id:p}).then(A=>{A.status===200&&A.blob().then(k=>{a.chat.FILE[p]&&a.chat.FILE[p].blob?a.chat.FILE[p].blob=URL.createObjectURL(k):a.chat.FILE={...a.chat.FILE,[p]:{blob:URL.createObjectURL(k)}},i.value&&(i.value.src=a.chat.FILE[p]?a.chat.FILE[p].blob:null)})})};return(p,A)=>(u(),f("img",{onClick:A[0]||(A[0]=k=>_()),class:"message-image mr-2",src:v(s.img_id),ref_key:"img",ref:i},null,8,Ie))}},Me=s=>(W("data-v-7174f0f8"),s=s(),ee(),s),Se=Me(()=>l("i",{class:"ri-folder-zip-line"},null,-1)),Ge=[Se],Le={__name:"MessageFile",setup(s){const a=function(){alert("tính năng đang thực hiện")};return(i,d)=>(u(),f("div",{class:"file-message file-upload",onClick:a},Ge))}},we=N(Le,[["__scopeId","data-v-7174f0f8"]]),Ce={class:"flex-shrink-0 chat-user-img online user-own-img align-self-center me-1 ms-0"},Ue={class:"flex-grow-1 pe-1"},je={class:"text-truncate mb-0 text-white text-capitalize"},Q={__name:"TagRoom",props:["id"],setup(s){const a=b(),i=$.useEvent();return(d,n)=>c(a).chat.ROOM[s.id]?(u(),f("div",{key:0,class:"d-flex align-items-center mx-1 cursor-pointer bg-success my-1 me-2",onClick:n[0]||(n[0]=g=>c(i).emit("show-modal-room-info",s.id))},[l("div",Ce,[c(a).chat.ROOM[s.id].icon?(u(),L(ie,{key:0,img_id:c(a).chat.ROOM[s.id].icon,class:"avatar-xxs"},null,8,["img_id"])):y("",!0)]),l("div",Ue,[l("span",je,[l("a",null,R(c(a).chat.ROOM[s.id].name),1)])])])):y("",!0)}},Pe={class:"flex-shrink-0 chat-user-img online user-own-img align-self-center me-1 ms-0"},De=["src","alt"],Ne={class:"flex-grow-1 overflow-hidden"},Fe={class:"text-truncate mb-0 fs-16 text-dark"},Be={__name:"GuestInfo",props:["id"],setup(s){const a=s,i=b(),d=$.useEvent(),n=K({overlay:!1,user:{}});return q(async()=>{if(i.chat.GUEST[a.id])n.user=i.chat.GUEST[a.id];else{n.overlay=!0;const g=await i.getUserInfo(a.id);g.success&&(n.user=i.chat.GUEST[a.id]=g.data.USER[a.id]),n.overlay=!1}}),(g,_)=>c(n).user?(u(),f("div",{key:0,class:"d-flex align-items-center cursor-pointer me-2 my-1",onClick:_[0]||(_[0]=v=>c(d).emit("show-modal-user-info",c(n).user.id))},[l("div",Pe,[l("img",{src:c(n).user.avatar?c(n).user.avatar:"https://ui-avatars.com/api/?name="+c(n).user.name,class:"rounded-circle avatar-xxs",alt:c(n).user.name},null,8,De)]),l("div",Ne,[l("p",Fe,[l("a",null,R(c(n).user.name),1)])])])):y("",!0)}},ze={class:"d-flex flex-wrap"},Ve=["onClick"],He={class:"flex-shrink-0 chat-user-img online user-own-img align-self-center me-1 ms-0"},Ye=["src"],Ke={class:"flex-grow-1 pe-1"},qe={class:"text-truncate mb-0 text-dark text-capitalize"},Qe={__name:"TagMembers",props:["members"],setup(s){const a=b(),i=s,d=$.useEvent();return(n,g)=>(u(),f("div",ze,[(u(!0),f(G,null,te(i.members.split("-"),_=>(u(),f("div",null,[c(a).chat.USER[_]?(u(),f("div",{key:0,class:"d-flex align-items-center cursor-pointer my-1 me-2",onClick:v=>c(d).emit("show-modal-user-info",_)},[l("div",He,[l("img",{src:c(a).chat.USER[_].avatar?c(a).chat.USER[_].avatar:"https://ui-avatars.com/api/?name="+c(a).chat.USER[_].name,class:"rounded-circle avatar-xxs",alt:"store.chat.USER[id].name"},null,8,Ye)]),l("div",Ke,[l("span",qe,[l("a",null,R(c(a).chat.USER[_].name),1)])])],8,Ve)):(u(),L(Be,{key:1,id:_},null,8,["id"]))]))),256))]))}};function D(s,a="px"){if(!(s==null||s===""))return isNaN(s)?String(s):`${Number(s)}${a}`}const Xe=Symbol(),Ze={shimmer:!0};function Je(){return ae(Xe,Ze)}const C=se({name:"Skeletor",props:{as:{type:String,default:"span"},circle:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},size:{type:[String,Number],default:null},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},shimmer:{type:Boolean,default:void 0}},setup(s){const a=Je(),i=S(()=>!s.circle&&(s.size||s.height)),d=S(()=>!s.circle&&!s.size&&!s.height),n=S(()=>s.shimmer!==void 0?!s.shimmer:!a.shimmer),g=S(()=>({"vue-skeletor":!0,"vue-skeletor--rect":i.value,"vue-skeletor--text":d.value,"vue-skeletor--shimmerless":n.value,"vue-skeletor--circle":s.circle,"vue-skeletor--pill":s.pill})),_=S(()=>{const p={};if(s.size){const A=D(s.size);p.width=A,p.height=A}return!s.size&&s.width&&(p.width=D(s.width)),!s.size&&s.height&&(p.height=D(s.height)),p}),v=d.value?"‌":null;return()=>H(s.as,{class:g.value,style:_.value},[v])}}),We={class:"link-preview"},et={key:0,class:"flex-grow-1"},tt=l("span",{class:"spinner-border spinner-border-sm mr-2"},null,-1),st={key:1,class:"flex-grow-1"},at={key:0},nt=["href"],ot={class:"link-preview-section text-center mt-1"},rt={class:"d-flex justify-content-between"},it={class:"flex-fill"},ct={class:"flex-shrink-0"},lt={key:1,class:"d-flex link-preview-section"},mt={class:"flex-fill justify-content-end me-2 link-description"},dt={class:"link-data"},ut=["href"],_t={class:"link-title"},pt={class:"link-description"},ht={key:0,class:"flex-grow-1 link-image"},ft=["src"],gt="https://jsonlink.io/api/extract?url=",vt="pk_00347f8ed2a7f269cb3b71e37a9f85cd16700c51",Et={__name:"PreviewLinkApp",props:["url","local"],setup(s){const a=b(),i=s,d=$.useEvent(),n=K({show:!1,room_id:0,message_id:0,html:null});q(async()=>{if(i.local>=0){const v=i.url.match(/rid[-\d+]+[-\d+]/i)[0].split("-");v[1]&&v[2]?(n.room_id=v[1],n.message_id=v[2],await a.getMessage(n.message_id,{room_id:n.room_id})):v[1]&&(n.room_id=v[1])}else{const _=gt+i.url+"&api_key="+vt;n.html=await fetch(_).then(v=>v.json())}});const g=function(){n.room_id&&n.message_id&&a.chat.CURRENT_ROOM.id===n.room_id?d.emit("chat_scroll_id",{id:n.message_id}):n.room_id&&n.message_id&&d.emit("change-room",{id:n.room_id,position:n.message_id})};return(_,v)=>(u(),f("div",We,[s.local>=0?(u(),f(G,{key:0},[l("a",{class:"domain text-info text-truncate cursor-pointer",onClick:g},R(s.url),1),c(n).room_id&&c(n).message_id?(u(),f("div",et,[c(a).chat.MESSAGE[c(n).room_id+"_"+c(n).message_id]?(u(),L(X,{key:0,item:c(a).chat.MESSAGE[c(n).room_id+"_"+c(n).message_id]},null,8,["item"])):(u(),f(G,{key:1},[tt,ne(" loading.. ")],64))])):c(n).room_id?(u(),f("div",st,[O(Q,{id:c(n).room_id},null,8,["id"])])):y("",!0)],64)):(u(),f(G,{key:1},[c(n).html===null?(u(),f("div",at,[l("a",{href:s.url,class:"domain text-info"},R(s.url),9,nt),l("div",ot,[l("div",rt,[l("div",it,[O(c(C),{height:"15",class:"mb-2"}),O(c(C),{height:"15",class:"mb-2"}),O(c(C),{height:"15",class:"mb-2"})]),l("div",ct,[O(c(C),{height:"60",width:"60",class:"mx-2"})])])])])):(u(),f("div",lt,[l("div",mt,[l("div",dt,[l("a",{href:s.url,class:"domain text-info"},R(s.url),9,ut),l("div",_t,R(c(n).html.title),1),l("div",pt,R(c(n).html.description),1)])]),c(n).html.images?(u(),f("div",ht,[c(n).html.images[0]?(u(),f("img",{key:0,class:"avatar-lg",src:c(n).html.images[0],alt:"data.html.title"},null,8,ft)):y("",!0)])):y("",!0)]))],64))]))}},At={name:"Dynamic",props:{content:{required:!0,type:String}},components:{VRuntimeTemplate:ce,MessageToIcon:fe,MessageReplyIcon:Ae,MessageCopyIcon:ke,MessageEmoji:ye,MessageImage:$e,MessageFile:we,TagAuth:F,TagRoom:Q,TagMembers:Qe,PreviewLinkApp:Et}};function Tt(s,a,i,d,n,g){const _=oe("v-runtime-template");return u(),L(_,{template:i.content},null,8,["template"])}const xt=N(At,[["render",Tt]]),X={__name:"MessageRender",props:["item"],setup(s){const{t:a}=re(),i=s,d=function(){if(i.item){let o=[],t=i.item.content.replace(/<|>|&/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;"}});if(t=t.replace(r.TAG.TAG_BIND_VUE_OPEN,"&#123;&#173;&#123;&#173;"),t=t.replace(r.TAG.TAG_BIND_VUE_CLOSE,"&#125;&#173;&#125;&#173;"),i.item.status!==0){t=p(t,o),t=A(t,i.item),t=w(t,i.item),t=k(t,i.item),t=t.replace(r.TAG.TAG_BOLD,function(e){return e=e.replace(r.TAG.TAG_B_RM_PR,"<b>"),e.replace(r.TAG.TAG_B_RM_EN,"</b>")}),t=t.replace(r.TAG.TAG_ITALIC,function(e){return e=e.replace(r.TAG.TAG_I_RM_PR,"<i>"),e.replace(r.TAG.TAG_I_RM_EN,"</i>")}),t=n(t),t=g(t),t=v(t),t=_(t),t=j(t),t=U(t);for(let e in z.ICON){const m=z.ICON[e];t=t.split("-"+m.code).join('<message-emoji class="icon-scale-x" src="'+m.src+'"></message-emoji>'),t=t.split("+"+m.code).join('<message-emoji class="icon-scale-y" src="'+m.src+'"></message-emoji>'),t=t.split(m.code).join('<message-emoji src="'+m.src+'"></message-emoji>')}if(o.length>0)for(let e in o)t.indexOf(r.REPLACE_MESSAGE.CODE)!==-1?(o[e]=o[e].replace("[code]",'<div class="chat-code"><pre class="code_message_format">'),o[e]=o[e].replace("[/code]",'</pre><message-copy-icon class_name="tag-code"/></div>'),o[e]=o[e].replace(r.REPLACE_MESSAGE.CODE,r.REPLACE_MESSAGE.UN_CODE),t=t.replace(r.REPLACE_MESSAGE.CODE,o[e])):(o[e]=o[e].replace(r.REPLACE_MESSAGE.CODE,r.REPLACE_MESSAGE.UN_CODE),t=t.replace(r.REPLACE_MESSAGE.UN_CODE,o[e]));t='<pre class="content-message">'+t+"</pre>"}else t='<div class="msg-deleted">Message deleted.</div>';return t}},n=function(o){return o.replace(r.ROOM.CREATE,t=>{let e='<div class="room-create d-flex flex-wrap align-items-center">{auth}'+a("chat.message.created-room")+"<div>{room}</div></div>",m=x(t),E=I(t);return e=e.replace(/{auth}/g,m),e=e.replace(/{room}/g,E),e=e.replace(r.TAG.ALL_TAG,""),e})},g=function(o){return o.replace(r.ROOM.UPDATE,t=>{let e='<div class="room-update d-flex flex-wrap align-items-center">{auth} '+a("chat.message.updated-room-info")+"<div>{room}</div></div>",m=x(t),E=I(t);return e=e.replace(/{auth}/g,m),e=e.replace(/{room}/g,E),e=e.replace(r.TAG.ALL_TAG,""),e})},_=function(o){return o.replace(r.TAG.LINK,t=>{const e=t.search(r.TAG.LINK_APP);return'<preview-link-app url="'+t+'" local="'+e+'"></preview-link-app>'})},v=function(o){return o=o.replace(r.ROOM.ADD_MEMBER,t=>{let e='<div class="room-add-member d-flex align-items-center">{auth}'+a("chat.message.added-members-to-room")+"{members}",m=x(t),E=T(t);return e=e.replace(/{auth}/g,m),e=e.replace(/{members}/g,E),e=e.replace(r.TAG.ALL_TAG,""),e}),o=o.replace(r.ROOM.UPDATE_MEMBER,t=>{let e='<div class="room-update-member d-flex align-items-center">{auth}'+a("chat.message.change-role-in-room")+"</div>{members}",m=x(t),E=T(t);return e=e.replace(/{auth}/g,m),e=e.replace(/{members}/g,E),e=e.replace(r.TAG.ALL_TAG,""),e}),o=o.replace(r.ROOM.DELETE_MEMBER,t=>{let e='<div class="room-delete-member d-flex align-items-center">{auth}'+a("chat.message.remove-member-in-room")+"</div>{members}",m=x(t),E=T(t);return e=e.replace(/{auth}/g,m),e=e.replace(/{members}/g,E),e=e.replace(r.TAG.ALL_TAG,""),e}),o=o.replace(r.ROOM.LEAVE_MEMBER,t=>{let e='<div class="room-leave-member d-flex align-items-center">{auth}'+a("chat.message.leaved-room")+"</div>",m=x(t);return e=e.replace(/{auth}/g,m),e=e.replace(r.TAG.ALL_TAG,""),e}),o},p=function(o,t){if(o.match(r.TAG.TAG_CODE)){let e=o.lastIndexOf("[code]"),m=o.substring(e),E=m.indexOf("[/code]");e!==-1&&E!==-1?(E+=7,m=m.substring(0,E),o=o.substring(0,e)+r.REPLACE_MESSAGE.CODE+o.substring(e+E,o.length),t.unshift(m)):o="",o=p(o,t)}return o},A=function(o,t){return o.replace(r.TAG.TO_ALL,function(){return t.mention=!0,r.HTML.TO_ALL})},k=function(o,t){return o.replace(r.TAG.TO,function(e){let m=e.match(r.TAG.TO_ID);return parseInt(m[1])===b().chat.CURRENT_USER.id&&(t.mention=!0),`<message-to-icon :user_id="${parseInt(m[1])}"/>`})},x=function(o){return o.replace(r.TAG.AUTH,function(t){let e=t.match(r.TAG.AUTH_ID);return`<tag-auth :id="${parseInt(e[1])}"/>`})},I=function(o){return o.replace(r.TAG.ROOM,function(t){let e=t.match(r.TAG.ROOM_ID);return`<tag-room :id="${parseInt(e[1])}"/>`})},T=function(o){return o.replace(r.TAG.MEMBER,function(t){return'<tag-members members="'+t.match(r.TAG.MEMBER_ID)[1]+'"/>'})},w=function(o,t){return o.replace(r.TAG.REPLY,function(e){let m=e.match(r.TAG.REPLY_TO_ID),E=e.match(r.TAG.REPLY_MESSAGE_ID),M=e.match(r.TAG.REPLY_ROOM_ID);return parseInt(m[1])===parseInt(b().chat.CURRENT_USER.id)&&(t.mention=!0),`<message-reply-icon :uid="${parseInt(m[1])}" :mid="${parseInt(E[1])}" :rid="${parseInt(M[1])}"/>`})},U=function(o){return o.replace(r.TAG.IMG,function(t){let e=t.match(r.TAG.IMG_ID);return`<message-image :img_id="${parseInt(e[1])}"/>`})},j=function(o){return o.replace(r.TAG.FILE,function(t){let e=t.match(r.TAG.FILE_ID);return`<message-file :file_id="${parseInt(e[1])}"/>`})};return(o,t)=>(u(),L(xt,{content:d()},null,8,["content"]))}};export{X as _,F as a};

import{a as j,H as z,l as L,m as W,b as U,r as J,o as r,d as q,w as d,f as m,v as O,g as a,G as I,u as o,y as h,t as i,T as K,c as n,F as _,e as x,n as w,x as P,J as Q,h as f,E as X,s as Y,L as Z,R as ee,M as se,W as te}from"./index-BMd-QA-V.js";import{_ as oe}from"./DErrors-Beq5o5sd.js";const ae={class:"flex-grow-0 avatar-sm me-2"},le=["src","alt"],ce={class:"flex-fill me-2"},re={class:"me-2 fw-bold text-truncate"},ne={class:"badge border border-success text-success"},de={key:1,class:"d-flex p-2 border border-groove me-2 my-1 rounded"},ie={class:"flex-grow-0 avatar-sm me-2"},ue=["src","alt"],me={class:"flex-fill me-2"},he={class:"me-2 fw-bold text-truncate"},_e={class:"badge border border-success text-success"},fe={key:0,class:"row mt-2"},pe={class:"col-12"},be={class:"form-group"},Re={class:"d-flex my-2"},ve={class:"bg-light me-2 p-2 border border-groove rounded"},ge={class:"flex-fill bg-light border border-groove rounded"},ke=["placeholder"],Ee={class:"list-contact py-1 px-3 border border-groove rounded",style:{"max-height":"400px","min-height":"300px","overflow-y":"auto"}},ye={key:0,class:"row border-bottom-inset border-1"},Me={class:"col-md-6 mb-2"},Ue={class:"my-3 pt-1"},Oe={key:0,class:"col-md-6 d-flex my-2"},xe={class:"flex-grow-1 my-1 me-2"},we=["onClick"],Ce=a("span",{class:"multiselect-tag-remove-icon"},null,-1),Te=[Ce],Se={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},$e={__name:"UpdateMember",setup(Ve){const e=j();z.useEvent();const p=L(null),c=W({check_all:!1,keyword:"",filterUser:[],saving:!1,response:null}),C=[{value:"1",label:"Member"},{value:"2",label:"Admin"},{value:"3",label:"Read Only"}],R=function(s){const l=e.chat.MEMBER[e.chat.CURRENT_ROOM.id+"_"+s].type;return l===1?"Member":l===2?"Admin":"Read only"},T=function(){for(let s of k.value)s.check=c.check_all},S=function(){return c.saving||Object.keys(b.value).length===0||v()!==2||g()===4},V=function(s){for(const l in e.chat.ROOM_MEMBER[e.chat.CURRENT_ROOM.id])if(e.chat.ROOM_MEMBER[e.chat.CURRENT_ROOM.id][l]===s)return!0;return!1},v=function(){const s=e.chat.CURRENT_ROOM.id+"_"+e.chat.CURRENT_USER.id;return e.chat.MEMBER[s]?e.chat.MEMBER[s].type:0},g=function(){const s=e.chat.CURRENT_ROOM.id;return e.chat.ROOM[s]?e.chat.ROOM[s].type:0},N=function(){c.check_all=!1,c.keyword="",c.response=null},B=function(){e.users.forEach(s=>{V(s.id)?(s.check=!0,s.role=e.chat.MEMBER[e.chat.CURRENT_ROOM.id+"_"+s.id].type):(s.check=!1,s.role=1)}),e.users.sort((s,l)=>l.check-s.check)},k=U(()=>{if(e.users)return e.users.filter(s=>s.name.includes(c.keyword))}),b=U(()=>{let s={};if(e.users)for(let l of e.users)l.check&&l.id!==e.chat.CURRENT_USER.id&&(s[l.id]=l.role);return s}),$=async function(){Object.keys(b.value).length>0&&X({title:"are you sure save info ?"}).then(async s=>{if(s.isConfirmed){c.saving=!0;const l=await e.updateRoom(e.chat.CURRENT_ROOM.id,{members:b.value});l.success?(p.value.hide(),Y({icon:"success",title:Z.global.t("common.message.success")})):c.response=l,c.saving=!1}})};return(s,l)=>{const E=ee,G=J("Multiselect"),y=se,D=te;return r(),q(D,{onShown:B,onHidden:N,id:"update_member_modal",title:s.$t("chat.message.update-member"),scrollable:"",size:"lg",ref_key:"modal",ref:p},{footer:d(()=>[m(y,{variant:"secondary",class:"w-sm btn-save-modal",disabled:S(),onClick:$},{default:d(()=>[O(a("span",Se,null,512),[[I,o(c).saving]]),h(" "+i(s.$t("common.form.save")),1)]),_:1},8,["disabled"]),m(y,{variant:"outline-secondary",onClick:l[3]||(l[3]=t=>o(p).hide())},{default:d(()=>[h(i(s.$t("common.form.cancel")),1)]),_:1})]),default:d(()=>[m(oe,{response:o(c).response},null,8,["response"]),m(K,{tag:"div",class:"d-flex flex-wrap",style:{"max-height":"220px","overflow-y":"scroll"}},{default:d(()=>[(r(!0),n(_,null,x(o(e).chat.ROOM_MEMBER[o(e).chat.CURRENT_ROOM.id],t=>(r(),n(_,null,[o(e).chat.USER[t]?(r(),n("div",{key:0,class:w(["d-flex p-2 border border-groove me-2 my-1 rounded",{"bg-light border-success":t===o(e).chat.CURRENT_USER.id}])},[a("div",ae,[a("img",{src:o(e).chat.USER[t].avatar?o(e).chat.USER[t].avatar:"https://ui-avatars.com/api/?name="+o(e).chat.USER[t].name,alt:o(e).chat.USER[t].name,class:"rounded-circle img-fluid"},null,8,le)]),a("div",ce,[a("div",re,i(o(e).chat.USER[t].name),1),a("div",ne,i(R(t)),1)])],2)):(r(),n("div",de,[a("div",ie,[a("img",{src:o(e).chat.GUEST[t].avatar?o(e).chat.GUEST[t].avatar:"https://ui-avatars.com/api/?name="+o(e).chat.GUEST[t].name,alt:o(e).chat.GUEST[t].name,class:"rounded-circle img-fluid"},null,8,ue)]),a("div",me,[a("div",he,i(o(e).chat.GUEST[t].name),1),a("div",_e,i(R(t)),1)])]))],64))),256))]),_:1}),v()===2&&g()!==4?(r(),n("div",fe,[a("div",pe,[a("div",be,[a("div",Re,[a("div",ve,[m(E,{modelValue:o(c).check_all,"onUpdate:modelValue":l[0]||(l[0]=t=>o(c).check_all=t),onChange:l[1]||(l[1]=t=>T()),id:"check_all_members"},{default:d(()=>[h(i(s.$t("chat.message.check-all")),1)]),_:1},8,["modelValue"])]),a("div",ge,[O(a("input",{type:"text",class:"form-control bg-light border-light",placeholder:s.$t("chat.message.search-contact"),"onUpdate:modelValue":l[2]||(l[2]=t=>o(c).keyword=t)},null,8,ke),[[P,o(c).keyword]])])]),a("div",Ee,[(r(!0),n(_,null,x(o(k),(t,F)=>(r(),n(_,{key:F},[t.id!==o(e).chat.CURRENT_USER.id?(r(),n("div",ye,[a("div",Me,[a("div",Ue,[m(E,{modelValue:t.check,"onUpdate:modelValue":u=>t.check=u,id:"check-item-members-"+t.id},{default:d(()=>[h(i(t.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","id"])])]),t.check?(r(),n("div",Oe,[a("div",xe,[m(o(Q),{name:"member_roles"+t.id,modelValue:t.role,"onUpdate:modelValue":u=>t.role=u},{default:d(()=>[m(G,{modelValue:t.role,"onUpdate:modelValue":u=>t.role=u,value:"1",options:C},{tag:d(({option:u,handleTagRemove:A,disabled:M})=>[a("div",{class:w(["multiselect-tag is-user",{"is-disabled":M}])},[a("span",null,i(u.label),1),M?f("",!0):(r(),n("span",{key:0,class:"multiselect-tag-remove",onClick:H=>A(u,H)},Te,8,we))],2)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["name","modelValue","onUpdate:modelValue"])])])):f("",!0)])):f("",!0)],64))),128))])])])])):f("",!0)]),_:1},8,["title"])}}};export{$e as default};

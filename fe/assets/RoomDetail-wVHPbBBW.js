import{_ as A,a as B,l as S,H as j,m as G,o as n,d as F,w as h,f as m,v as w,g as e,G as N,y as f,t as p,u as o,I as D,c as r,F as y,e as $,J as V,x as L,K as I,s as W,L as z,M as q,W as K,p as P,k as X,b as Y,h as k,n as J,T as Q,N as Z,E as ee,O as te,Y as se,P as oe}from"./index-BMd-QA-V.js";import H from"./ImageFile-SGnJshYu.js";import{_ as ae}from"./FileSize-D3D-1plQ.js";import{_ as ie}from"./DErrors-Beq5o5sd.js";const O=x=>(P("data-v-ecd12c33"),x=x(),X(),x),le={class:"row"},ne={class:"col-3 d-flex justify-content-center align-items-center"},re={key:1,src:"https://ui-avatars.com/api/?name=Room",class:"rounded-circle avatar-lg",alt:""},ce={class:"small text-center mt-2"},de={class:"row"},me={class:"col-12"},_e={class:"border-1"},pe=["src"],ue=["innerHTML"],he={class:"col-12"},fe=O(()=>e("label",{class:"form-label",for:"customFile"},"Choose File",-1)),ve={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},ge={class:"col-9"},be={class:"mb-1"},ye={class:"form-label mt-2 pe-2"},Re=O(()=>e("span",{class:"text-danger"},"*",-1)),we={class:"flex-grow-1"},xe=["placeholder"],Ee={class:"mb-1"},ke={class:"form-label mt-2 pe-2"},$e=O(()=>e("span",{class:"text-danger"},"*",-1)),Ue={class:"flex-grow-1"},Ce=["placeholder"],Me={class:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"},Te={__name:"RoomUpdate",setup(x){const u=B(),s=S(null);j.useEvent();const E=S(null),t=G({overlay:!1,saving:!1,disabled:!0,modal:!1,response:null,files:[],scr_preview:[],icon_preview:[],waiting_upload:!1,form:{name:"",description:"",icon:""}}),g=function(c){t.scr_preview=[];for(let i of c.target.files)i.type.substring(0,5)==="image"?t.scr_preview.push(URL.createObjectURL(i)):t.icon_preview.push('<i class="ri-folder-zip-line"></i>'),t.files.push(i)},C=async function(){if(t.files!==null){let c=new FormData;t.waiting_upload=!0;for(let a=0;a<t.files.length;a++)t.files[a].name!==void 0&&c.append("file[]",t.files[a]);c.append("room_id",u.chat.CURRENT_ROOM.id);const i=await u.uploadFile(c);i.success&&(t.show_upload_avatar=!1,t.form.icon=Object.keys(i.data.FILE)[0])}},M=function(){const c=u.chat.CURRENT_ROOM.id+"_"+u.chat.CURRENT_USER.id;return u.chat.MEMBER[c]?u.chat.MEMBER[c].type:0},T={name:"required",description:"required"},U=function(){E.value.hide()},l=function(){t.response=null,t.form.name=u.room.name,t.form.description=u.room.description,t.form.icon=u.room.icon},d=function(){t.form.name="",t.form.description="",t.form.icon=""},v=async function(){if((await s.value.validate()).valid){t.saving=!0;const i=await u.updateRoom(u.chat.CURRENT_ROOM.id,t.form);i!=null&&i.success?(d(),W({icon:"success",title:z.global.t("common.message.success")}),U()):t.response=i,t.saving=!1}};return(c,i)=>{const a=q,R=K;return n(),F(R,{onShown:l,id:"update_room_info",ref_key:"modal",ref:E,title:"Sửa thông tin Room",scrollable:"",size:"lg"},{footer:h(()=>[m(a,{type:"submit",variant:"secondary",class:"w-sm",disabled:t.saving||M()!==2,onClick:v},{default:h(()=>[w(e("span",Me,null,512),[[N,t.saving]]),f(" "+p(c.$t("common.form.save")),1)]),_:1},8,["disabled"]),m(a,{variant:"outline-secondary",onClick:U},{default:h(()=>[f(p(c.$t("common.form.cancel")),1)]),_:1})]),default:h(()=>[m(ie,{response:t.response},null,8,["response"]),m(o(D),{"validation-schema":T,ref_key:"form",ref:s,class:"form-add-room"},{default:h(()=>[e("div",le,[e("div",ne,[e("div",{class:"avatar-lg cursor-pointer",onClick:i[0]||(i[0]=_=>t.show_upload_avatar=!t.show_upload_avatar)},[t.form.icon?(n(),F(H,{key:0,img_id:t.form.icon,class:"rounded-circle img-fluid userprofile"},null,8,["img_id"])):(n(),r("img",re)),e("div",ce,p(c.$t("chat.message.click-to-upload")),1)]),m(R,{modelValue:t.show_upload_avatar,"onUpdate:modelValue":i[3]||(i[3]=_=>t.show_upload_avatar=_),title:"Upload avatar",scrollable:""},{footer:h(()=>[m(a,{type:"submit",variant:"secondary",class:"w-sm",disabled:t.saving,onClick:C},{default:h(()=>[w(e("span",ve,null,512),[[N,t.saving]]),f(" "+p(c.$t("common.form.save")),1)]),_:1},8,["disabled"]),m(a,{variant:"outline-secondary",onClick:i[2]||(i[2]=_=>t.show_upload_avatar=!1)},{default:h(()=>[f(p(c.$t("common.form.cancel")),1)]),_:1})]),default:h(()=>[e("div",de,[e("div",me,[e("div",_e,[(n(!0),r(y,null,$(t.scr_preview,(_,b)=>(n(),r("img",{ref_for:!0,ref:"preview_image_upload",src:_,class:"mx-1 my-2",key:b,alt:"preview"},null,8,pe))),128)),(n(!0),r(y,null,$(t.icon_preview,(_,b)=>(n(),r("span",{innerHTML:_,key:b,class:"mx-1 my-2 file-upload"},null,8,ue))),128))])]),e("div",he,[fe,e("input",{type:"file",class:"form-control",ref:"fileUpload",onChange:i[1]||(i[1]=_=>g(_))},null,544)])])]),_:1},8,["modelValue"])]),e("div",ge,[e("div",be,[e("label",ye,[f(p(c.$t("chat.message.room-name"))+" ",1),Re]),e("div",we,[m(o(V),{name:"name",label:c.$t("chat.message.room-name"),class:"form-control",modelValue:t.form.name,"onUpdate:modelValue":i[5]||(i[5]=_=>t.form.name=_)},{default:h(({field:_})=>[w(e("input",{type:"text",class:"form-control","onUpdate:modelValue":i[4]||(i[4]=b=>t.form.name=b),placeholder:c.$t("chat.message.enter-room-name")},null,8,xe),[[L,t.form.name]])]),_:1},8,["label","modelValue"]),m(o(I),{name:"name",class:"text-danger"})])]),e("div",Ee,[e("label",ke,[f(p(c.$t("chat.message.description"))+" ",1),$e]),e("div",Ue,[m(o(V),{name:"description",label:c.$t("chat.message.description"),class:"form-control",modelValue:t.form.description,"onUpdate:modelValue":i[7]||(i[7]=_=>t.form.description=_)},{default:h(({field:_})=>[w(e("textarea",{type:"text",class:"form-control","onUpdate:modelValue":i[6]||(i[6]=b=>t.form.description=b),placeholder:c.$t("chat.message.enter-description")},null,8,Ce),[[L,t.form.description]])]),_:1},8,["label","modelValue"]),m(o(I),{name:"description",class:"text-danger"})])])])])]),_:1},512)]),_:1},512)}}},Oe=A(Te,[["__scopeId","data-v-ecd12c33"]]),Se={key:0,class:"sidebar-right p-0 bg-white"},Fe={key:0,class:"p-2"},Ne={class:"p-3 text-center bg-light"},Ve=["src","alt"],Le={class:"mt-3"},Ie={class:"fs-16 mb-1"},Be={href:"javascript:void(0);",class:"link-primary username"},je=e("p",{class:"text-muted"},[e("i",{class:"ri-checkbox-blank-circle-fill me-1 align-bottom text-success"}),f("Online")],-1),Ge=Z('<div class="d-flex gap-2 justify-content-center"><button type="button" class="btn avatar-xs p-0" data-bs-toggle="tooltip" data-bs-placement="top" title="Message"><span class="avatar-title rounded bg-light text-body"><i class="ri-question-answer-line"></i></span></button><button type="button" class="btn avatar-xs p-0" data-bs-toggle="tooltip" data-bs-placement="top" title="Favourite"><span class="avatar-title rounded bg-light text-body"><i class="ri-star-line"></i></span></button><button type="button" class="btn avatar-xs p-0" data-bs-toggle="tooltip" data-bs-placement="top" title="Phone"><span class="avatar-title rounded bg-light text-body"><i class="ri-phone-line"></i></span></button><div class="dropdown"><button class="btn avatar-xs p-0" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="avatar-title bg-light text-body rounded"><i class="ri-more-fill"></i></span></button><ul class="dropdown-menu dropdown-menu-end"><li><a class="dropdown-item" href="javascript:void(0);"><i class="ri-inbox-archive-line align-bottom text-muted me-2"></i>Archive</a></li><li><a class="dropdown-item" href="javascript:void(0);"><i class="ri-mic-off-line align-bottom text-muted me-2"></i>Muted</a></li><li><a class="dropdown-item" href="javascript:void(0);"><i class="ri-delete-bin-5-line align-bottom text-muted me-2"></i>Delete</a></li></ul></div></div>',1),He={key:1,class:"p-3"},Ae={class:"fs-15 mb-3 fw-bold"},De={class:"float-end cursor-pointer"},We=e("i",{class:"ri-pencil-fill align-bottom me-2 text-muted small"},null,-1),ze=[We],qe=["src","onClick","alt"],Ke={key:0,class:"flex-grow-0 chat-avatar avatar-sm m-1"},Pe=["src","alt","onClick"],Xe={class:"border-top border-top-dashed p-3"},Ye={class:"fs-15 mb-3 fw-bold"},Je={key:0,class:"float-end cursor-pointer"},Qe=e("i",{class:"ri-pencil-fill align-bottom me-2 text-muted small"},null,-1),Ze=[Qe],et={class:"vstack gap-2"},tt={class:"border rounded border-dashed p-2"},st={class:"border-top border-top-double p-3"},ot={class:"fs-15 mb-3 fw-bold"},at={class:"vstack gap-2"},it={class:"border rounded border-dashed p-2"},lt={class:"d-flex align-items-center"},nt={class:"flex-shrink-0 me-3"},rt={class:"avatar-xs"},ct={key:0,class:"avatar-xs me-2"},dt={key:1,class:"avatar-title bg-light text-secondary rounded fs-20"},mt=e("i",{class:"ri-folder-zip-line"},null,-1),_t=[mt],pt={class:"flex-fill overflow-hidden"},ut={class:"fs-13 mb-1"},ht={href:"#",class:"text-body d-block"},ft={class:"text-muted small"},vt={class:"d-flex align-items-end flex-column"},gt={class:"flex-grow-1"},bt=["onClick"],yt=e("i",{class:"ri-download-2-line align-bottom me-2 text-muted"},null,-1),Rt=[yt],wt=["onClick"],xt={key:0,class:"bx bx-loader bx-spin align-content-center text-muted"},Et={key:1,class:"ri-close-fill align-bottom text-muted",title:"Xóa tài liệu"},kt={class:"flex-grow-1 text-muted small text-truncate"},$t={key:1,class:"text-center border rounded border-dashed p-2"},Ut=e("i",{class:"ri-delete-bin-7-line fs-24 text-muted"},null,-1),Ct=e("div",{class:"text-center pb-3 mt-2"}," Không có file nào ",-1),Mt=[Ut,Ct],Nt={__name:"RoomDetail",setup(x){const u=new oe,s=B(),E=j.useEvent(),t=G({page:0,overlay:!1}),g=Y(()=>{if(s.room.type===3){for(const l in s.chat.CONTACT)if(s.chat.USER[l]&&s.chat.CONTACT[l].room_id===s.chat.CURRENT_ROOM.id)return s.chat.USER[l]}return[]}),C=function(){const l=s.chat.CURRENT_ROOM.id+"_"+s.chat.CURRENT_USER.id;return s.chat.MEMBER[l]?s.chat.MEMBER[l].type:0},M=async function(l){let d=l.target;Math.ceil(d.scrollTop)===d.scrollHeight-d.offsetHeight?t.page<s.chat.ROOM_FILE["total_page_"+s.chat.CURRENT_ROOM.id]-1&&(t.page++,t.overlay=!0,await s.getFiles({room_id:s.chat.CURRENT_ROOM.id,page:t.page}),d.scrollTop=1,t.overlay=!1):Math.ceil(d.scrollTop)<1&&t.page>1&&(t.page--,t.overlay=!0,await s.getFiles({room_id:s.chat.CURRENT_ROOM.id,page:t.page}),d.scrollTop=d.scrollHeight-d.offsetHeight-1,t.overlay=!1)},T=l=>{ee({title:"Xóa tài liệu "+l.name+"."+l.ext}).then(async d=>{d.isConfirmed&&(l.removing=!0,s.removeFile(l.id))})},U=async l=>{const d=document.createElement("a");document.body.appendChild(d),s.chat.FILE_RAW[l.id]||await u.getImageRaw({id:l.id}).then(v=>v.blob()).then(v=>{v&&(s.chat.FILE_RAW={...s.chat.FILE_RAW,[l.id]:{blob:URL.createObjectURL(v)}})}),d.style="display: none",d.href=s.chat.FILE_RAW[l.id].blob,d.download=l.name+"."+l.ext,d.click()};return(l,d)=>{var i;const v=te,c=se;return o(s).room?(n(),r("div",Se,[o(s).room.type===3?(n(),r("div",Fe,[e("div",Ne,[o(g)?(n(),r("img",{key:0,src:o(g).avatar?o(g).avatar:"https://ui-avatars.com/api/?name="+o(g).name,alt:o(g).name,class:"avatar-lg img-thumbnail mx-auto profile-img"},null,8,Ve)):k("",!0),e("div",Le,[e("h5",Ie,[e("a",Be,p((i=o(s).room)==null?void 0:i.name),1)]),je]),Ge])])):(n(),r("div",He,[e("h5",Ae,[f(p(l.$t("chat.message.member"))+" ",1),w((n(),r("a",De,ze)),[[c,void 0,void 0,{update_member_modal:!0}]])]),m(Q,{tag:"div",name:"fade",class:"d-flex flex-wrap",style:{"max-height":"220px","overflow-y":"scroll"}},{default:h(()=>[(n(!0),r(y,null,$(o(s).chat.ROOM_MEMBER[o(s).chat.CURRENT_ROOM.id],a=>(n(),r(y,null,[o(s).chat.USER[a]?(n(),r("div",{key:0,class:J(["flex-grow-0 avatar-sm m-1 cursor-pointer",{"border border-success":a===o(s).chat.CURRENT_USER.id}])},[e("img",{src:o(s).chat.USER[a].avatar?o(s).chat.USER[a].avatar:"https://ui-avatars.com/api/?name="+o(s).chat.USER[a].name,onClick:R=>o(E).emit("show-modal-user-info",o(s).chat.USER[a].id),alt:o(s).chat.USER[a].name,class:"img-fluid"},null,8,qe)],2)):k("",!0)],64))),256)),(n(!0),r(y,null,$(o(s).chat.ROOM_MEMBER[o(s).chat.CURRENT_ROOM.id],a=>(n(),r(y,null,[o(s).chat.GUEST[a]?(n(),r("div",Ke,[e("img",{src:o(s).chat.GUEST[a].avatar?o(s).chat.GUEST[a].avatar:"https://ui-avatars.com/api/?name="+o(s).chat.GUEST[a].name,alt:o(s).chat.GUEST[a].name,onClick:R=>o(E).emit("show-modal-user-info",o(s).chat.GUEST[a].id),class:"img-fluid"},null,8,Pe)])):k("",!0)],64))),256))]),_:1})])),e("div",Xe,[e("h5",Ye,[f(p(l.$t("chat.message.description"))+" ",1),C()!==2?w((n(),r("a",Je,Ze)),[[c,void 0,void 0,{update_room_info:!0}]]):k("",!0)]),e("div",et,[e("div",tt,p(o(s).room.description),1)]),m(Oe)]),e("div",st,[e("h5",ot,p(l.$t("chat.message.file-in-room")),1),m(v,{show:o(t).overlay,"spinner-variant":"secondary"},{default:h(()=>[o(s).room_files&&o(s).room_files.length>0?(n(),r("div",{key:0,class:"b-overlay-wrap",style:{"max-height":"300px","overflow-y":"auto"},onScroll:d[0]||(d[0]=a=>M(a))},[(n(!0),r(y,null,$(o(s).room_files,a=>(n(),r("div",at,[e("div",it,[e("div",lt,[e("div",nt,[e("div",rt,[a.type==="image"?(n(),r("div",ct,[m(H,{img_id:a.id,class:"img-fluid userprofile"},null,8,["img_id"])])):(n(),r("div",dt,_t))])]),e("div",pt,[e("h5",ut,[e("a",ht,p(a.name)+"."+p(a.ext),1)]),e("div",ft,[m(ae,{item:a},null,8,["item"])])]),e("div",vt,[e("div",gt,[e("a",{class:"cursor-pointer",onClick:R=>U(a)},Rt,8,bt),e("a",{class:"cursor-pointer",onClick:R=>T(a)},[a.removing?(n(),r("i",xt)):(n(),r("i",Et))],8,wt)]),e("span",kt,p(l.filters.fromNow(a.created_at)),1)])])])]))),256))],32)):(n(),r("div",$t,Mt))]),_:1},8,["show"])])])):k("",!0)}}};export{Nt as default};
